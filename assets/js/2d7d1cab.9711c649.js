"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8001],{2535:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>m,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>_});var n=a(4848),r=a(8453);const o={},s=void 0,i={id:"maya/programming/example/bake_tranform_to_parent_offset_matrix",title:"bake_tranform_to_parent_offset_matrix",description:"Using the new Parent Offset Matrix in Maya 2020 but it is still a bit sus.",source:"@site/docs/maya/programming/example/bake_tranform_to_parent_offset_matrix.md",sourceDirName:"maya/programming/example",slug:"/maya/programming/example/bake_tranform_to_parent_offset_matrix",permalink:"/docs/maya/programming/example/bake_tranform_to_parent_offset_matrix",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/maya/programming/example/bake_tranform_to_parent_offset_matrix.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"3DS to Maya Layers",permalink:"/docs/maya/programming/example/3ds_to_maya_layers"},next:{title:"Check Non Zero Transform",permalink:"/docs/maya/programming/example/check_non_zero_transform"}},m={},_=[];function f(t){const e={code:"code",p:"p",pre:"pre",...(0,r.R)(),...t.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:"Using the new Parent Offset Matrix in Maya 2020 but it is still a bit sus.\nMaybe for personal projects but for commercial projects, a bit hard to implement"}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-python",children:'import maya.api.OpenMaya as om\nimport maya.cmds as cmds\n\nTRANSFORM_NODETYPES = ["transform", "joint"]\n\ndef has_non_default_locked_attributes(node):\n    locked_attributes = []\n    for attribute in ["translate", "rotate", "scale", "jointOrient"]:\n        default_value = 1 if attribute == "scale" else 0\n        for axis in "XYZ":\n            if cmds.attributeQuery(attribute + axis, node=node, exists=True):\n                attribute_name = "{}.{}{}".format(node, attribute, axis)\n                current_value = cmds.getAttr(attribute_name)\n                if cmds.getAttr(attribute_name, lock=True) and current_value != default_value:\n                    return True\n\n\ndef reset_transforms(node):\n    for attribute in ["translate", "rotate", "scale", "jointOrient"]:\n        value = 1 if attribute == "scale" else 0\n        for axis in "XYZ":\n            if cmds.attributeQuery(attribute + axis, node=node, exists=True):\n                attribute_name = "{}.{}{}".format(node, attribute, axis)\n                if not cmds.getAttr(attribute_name, lock=True):\n                    cmds.setAttr(attribute_name, value)\n\n\ndef bake_transform_to_offset_parent_matrix(node):\n    if cmds.nodeType(node) not in TRANSFORM_NODETYPES:\n        raise ValueError("Node {} is not a transform node".format(node))\n\n    if has_non_default_locked_attributes(node):\n        raise RuntimeError("Node {} has at least one non default locked attribute(s)".format(node))\n\n    local_matrix = om.MMatrix(cmds.xform(node, q=True, m=True, ws=False))\n    offset_parent_matrix = om.MMatrix(cmds.getAttr(node + ".offsetParentMatrix"))\n    baked_matrix = local_matrix * offset_parent_matrix\n    cmds.setAttr(node + ".offsetParentMatrix", baked_matrix, type="matrix")\n\n    reset_transforms(node)\n\ndef bake_transform_to_offset_parent_matrix_selection():\n    for node in cmds.ls(sl=True):\n        bake_transform_to_offset_parent_matrix(node)\n\nif __name__ == "__main__":\n    bake_transform_to_offset_parent_matrix_selection()\n'})})]})}function d(t={}){const{wrapper:e}={...(0,r.R)(),...t.components};return e?(0,n.jsx)(e,{...t,children:(0,n.jsx)(f,{...t})}):f(t)}},8453:(t,e,a)=>{a.d(e,{R:()=>s,x:()=>i});var n=a(6540);const r={},o=n.createContext(r);function s(t){const e=n.useContext(o);return n.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function i(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(r):t.components||r:s(t.components),n.createElement(o.Provider,{value:e},t.children)}}}]);